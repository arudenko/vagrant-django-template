server {

    listen 80;
    server_name <%= production_domain %> *.<%= production_domain %> <%= staging_domain %><%= if environment == "vagrant" %> localhost<% end %>;

    error_log /var/log/nginx/<%= full_project_name %>.error.log;
    access_log /var/log/nginx/<%= full_project_name %>.access.log;


    # Set proxy headers for the passthrough
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

    # Let the Set-Cookie header through.
    proxy_pass_header Set-Cookie;

    # Set the timeout to Apache
    proxy_read_timeout 120;

    # Live domain only.
    ## www.domain.com -> domain.com (301 - Permanent)
    if ($host != '<%= production_domain %>') {
        rewrite ^/(.*)$ http://<%= production_domain %>/$1 permanent; 
    }

    # Max upload size.
    client_max_body_size 8m;

    # All media (including uploaded) is under wp-content/ so
    # instead of caching the response from apache, we're just
    # going to use nginx to serve directly from there.
    location <%= static_url %> {
        alias <%= static_path %>;
    }

    location <%= media_url %> {
        alias <%= media_path %>;
    }

    location / {
        proxy_pass http://127.0.0.1:81;
    }
} # End server
